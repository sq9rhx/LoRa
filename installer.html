<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>ESP32 Web Flasher</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- ESP Web Tools -->
  <script type="module" src="https://unpkg.com/esp-web-tools@9/dist/web/install-button.js"></script>

  <style>
    body {
      background: #f5f7fa;
    }
    .card {
      margin-top: 60px;
      border-radius: 12px;
    }
    esp-web-install-button {
      width: 100%;
      margin-top: 20px;
    }
  </style>
</head>

<body>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card shadow">
        <div class="card-body">

          <h3 class="text-center mb-4">ESP32 Web Flasher</h3>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="eraseFlash">
            <label class="form-check-label" for="eraseFlash">
              Erase flash (use merged firmware)
            </label>
          </div>

          <div class="mb-3">
            <label for="board" class="form-label">Wybierz płytkę:</label>
            <select id="board" class="form-select">
              <option value="aprs-e22">LoRa_APRS_ESP32-PoE_E22</option>
              <option value="aprs-ra02">LoRa_APRS_ESP32-PoE_RA02</option>
              <option value="mesh-e22p">Meshcore_ESP32-PoE_E22P</option>
            </select>
          </div>

          <esp-web-install-button id="flashButton"></esp-web-install-button>

        </div>
      </div>

    </div>
  </div>
</div>

<script>
const manifests = {
  "aprs-e22": {
    normal: "docs/aprs-e22/manifest.json",
    erase:  "docs/aprs-e22/manifest-erase.json"
  },
  "aprs-ra02": {
    normal: "docs/aprs-ra02/manifest.json",
    erase:  "docs/aprs-ra02/manifest-erase.json"
  },
  "mesh-e22p": {
    normal: "docs/mesh-e22p/manifest.json",
    erase:  "docs/mesh-e22p/manifest-erase.json"
  }
};

const boardSelect = document.getElementById("board");
const eraseCheckbox = document.getElementById("eraseFlash");
const flashButton = document.getElementById("flashButton");

function updateManifest() {
  const board = manifests[boardSelect.value];
  const manifestUrl = eraseCheckbox.checked ? board.erase : board.normal;
  flashButton.setAttribute("manifest", manifestUrl);
}

boardSelect.addEventListener("change", updateManifest);
eraseCheckbox.addEventListener("change", updateManifest);

updateManifest();
</script>

</body>
</html>
